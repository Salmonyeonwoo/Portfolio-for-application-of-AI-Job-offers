<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI 코치 포트폴리오 - 기술적 도전과제 해결 스토리</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&family=Noto+Sans+KR:wght@100..900&display=swap');
        body { 
            font-family: 'Noto Sans KR', 'Inter', sans-serif;
            background-color: #f7f9fb; /* Light background for clean look */
        }
        .code-block {
            background-color: #2d2d2d;
            color: #f8f8f2;
            padding: 1rem;
            border-radius: 0.5rem;
            overflow-x: auto;
            font-family: monospace;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div class="container mx-auto p-4 sm:p-8 max-w-4xl">

        <!-- Header (KOREAN) -->
        <header class="text-center mb-12 py-8 bg-white rounded-xl shadow-lg">
            <h1 class="text-4xl sm:text-5xl font-extrabold text-indigo-700">AI 스터디 코치 포트폴리오</h1>
            <p class="text-lg text-gray-600 mt-2">기술적 도전과제: Streamlit Firebase 연동 오류 해결 스토리</p>
        </header>

        <!-- Section 1: Challenge Overview -->
        <section class="mb-10 p-6 bg-white rounded-xl shadow-md">
            <h2 class="text-2xl font-bold text-red-600 mb-4 border-b pb-2">도전 과제 개요: 'Private Key' 인식 문제</h2>
            <p class="mb-4">Streamlit 환경에서 Firebase Admin SDK를 사용하여 Firestore 및 GCS에 연결하려 할 때, 서비스 계정의 **Private Key**를 로드하는 과정에서 지속적인 오류가 발생했습니다. 이는 배포 환경과 로컬 환경 간의 키 처리 방식 차이와 Streamlit의 Secret 관리 방식 때문이었습니다.</p>
            <ul class="list-disc list-inside text-gray-600">
                <li>**오류 발생 지점:** Private Key를 JSON 객체로 파싱하고 `credentials.Certificate()`에 전달할 때, Private Key 문자열의 줄바꿈 문자 (`\n`) 처리에서 문제 발생.</li>
                <li>**초기 원인:** `secrets.toml`에서 로드된 Private Key 문자열이 예상과 다르게 이스케이프되거나 파싱되는 문제.</li>
                <li>**핵심 목표:** 로컬 개발 및 GitHub 배포 환경 모두에서 안전하고 올바르게 키를 로드하는 솔루션 확보.</li>
            </ul>
        </section>

        <!-- Section 2: Resolution Effort Analysis (Chart) -->
        <section class="mb-10 p-6 bg-white rounded-xl shadow-md">
            <h2 class="text-2xl font-bold text-indigo-700 mb-4 border-b pb-2">해결 노력 비율 분석</h2>
            <div class="flex justify-center items-center">
                <canvas id="timeChart" class="max-w-xs"></canvas>
            </div>
        </section>

        <!-- Section 3: Final Secure Resolution (UPDATED) -->
        <section class="mb-10 p-6 bg-white rounded-xl shadow-md">
            <h2 class="text-2xl font-bold text-green-600 mb-4 border-b pb-2">보안 고려사항 및 최종 해결책</h2>
            <p class="mb-4 font-semibold">사용자님의 보안 우려를 반영하여, 로컬 파일 시스템에 민감한 키(`secrets.toml`)를 저장하는 위험을 완전히 제거하고, Streamlit의 모범 사례인 **환경 변수 폴백(Fallback)** 전략을 채택했습니다.</p>
            
            <h3 class="text-xl font-bold mt-6 mb-3">1. 로컬 파일 저장 회피 전략</h3>
            <p class="mb-3">앱 코드에서 `secrets.toml` 파일에 대한 직접적인 의존성을 제거하고, 키 로딩 함수가 다음 순서로 키를 찾도록 수정했습니다:</p>
            <ul class="list-disc list-inside ml-4 text-gray-600">
                <li>**1순위 (배포 환경):** Streamlit Cloud의 안전한 Secrets 저장소 (`st.secrets`)</li>
                <li>**2순위 (로컬 환경):** 운영체제 환경 변수 (`os.environ`)</li>
            </ul>
            
            <h3 class="text-xl font-bold mt-6 mb-3">2. Python 코드 샘플 (`load_secrets_securely` 함수)</h3>
            <p class="mb-3">키를 로드하는 Python 함수는 `st.secrets`에서 실패할 경우 `os.environ`을 시도하며, Private Key의 줄바꿈 문자를 정확히 처리합니다.</p>
            <div class="code-block">
<pre>
def load_secrets_securely():
    secrets = {}
    try:
        # 1순위: Streamlit Secrets (배포용)
        # ... st.secrets에서 키 로드 시도 ...
        private_key_content = st.secrets["FIREBASE_PRIVATE_KEY"]
    except Exception:
        # 2순위: 환경 변수 (로컬 보안 실행용)
        # ... os.environ에서 키 로드 시도 ...
        private_key_content = os.environ.get("FIREBASE_PRIVATE_KEY")
        
        # 환경 변수에서 로드 시, 줄바꿈 문자열 '\n'을 실제 줄바꿈으로 변환
        if private_key_content:
            private_key_content = private_key_content.replace('\\n', '\n')
    
    # ... 서비스 계정 정보 구성 및 반환 ...
    # (이 방식으로 GitHub에는 민감 정보 없이 코드만 올라갑니다.)
</pre>
            </div>

            <h3 class="text-xl font-bold mt-6 mb-3">3. PowerShell 실행 명령어</h3>
            <p class="mb-3">로컬에서 안전하게 실행하려면, 키 값을 환경 변수로 설정한 후 앱을 실행해야 합니다. Private Key의 줄바꿈은 반드시 `\n`으로 이스케이프해야 합니다.</p>
            <div class="code-block">
<pre>
$env:OPENAI_API_KEY="sk-YOUR_KEY"
$env:FIREBASE_PRIVATE_KEY='-----BEGIN PRIVATE KEY-----\n...\n-----END PRIVATE KEY-----\n'
streamlit run "streamlit_app (15).py"
</pre>
            </div>

        </section>

        <!-- Footer -->
        <footer class="text-center mt-12 py-4 border-t border-gray-300">
            <p>&copy; 2025 AI Coach Portfolio. Streamlit과 Gemini API를 기반으로 개발되었습니다.</p>
        </footer>

    </div>

    <script>
        const ctx = document.getElementById('timeChart');

        new Chart(ctx, {
            type: 'pie',
            data: {
                labels: ['DB Mode/Project Change', 'Secrets JSON Parsing', 'Private Key Authentication', 'Firestore Rules/Permissions'],
                datasets: [{
                    label: '해결 노력 비율 (Effort Ratio)',
                    data: [25, 35, 30, 10], // 비율 (합계 100)
                    backgroundColor: [
                        'rgba(233, 30, 99, 0.7)',  // Pink/Fuchsia
                        'rgba(255, 193, 7, 0.7)',  // Amber/Yellow
                        'rgba(244, 67, 54, 0.7)',  // Red
                        'rgba(76, 175, 80, 0.7)'   // Green
                    ],
                    borderColor: [
                        'rgba(255, 255, 255, 1)',
                        'rgba(255, 255, 255, 1)',
                        'rgba(255, 255, 255, 1)',
                        'rgba(255, 255, 255, 1)'
                    ],
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'top',
                    },
                    title: {
                        display: true,
                        text: '기술적 문제 해결에 투입된 시간 및 복잡도 비율'
                    }
                }
            }
        });
    </script>
</body>
</html>
