<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>K-Food 슬라이드 자동 감지</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
body {
  font-family: 'Inter', 'Noto Sans KR', sans-serif;
  margin:0; overflow:hidden; background:#111; color:white; display:flex; flex-direction:column; align-items:center; justify-content:center; height:100vh;
}
#slide-image { transition: opacity 0.3s ease-in-out; max-height:80vh; width:100%; object-fit:contain; }
#error-message { display:none; position:absolute; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.85); color:#f55; display:flex; flex-direction:column; align-items:center; justify-content:center; text-align:center; padding:2rem;}
</style>
</head>
<body>

<main class="w-full max-w-6xl bg-gray-800 rounded-lg shadow-2xl relative overflow-hidden">
  <div class="aspect-w-16 aspect-h-9 relative">
    <img id="slide-image" src="" alt="슬라이드 이미지">
    <div id="error-message">
      <h2 class="text-3xl font-bold text-red-400 mb-4">이미지 로딩 실패</h2>
      <p class="text-xl text-gray-300 mb-2">
        <code id="error-path" class="bg-gray-700 text-yellow-300 px-2 py-1 rounded"></code>
      </p>
      <p class="text-lg text-gray-400 max-w-2xl">
        이 HTML 파일과 같은 폴더에 <code class="bg-gray-700 px-1 rounded">Slides</code> 폴더가 있고, <code class="bg-gray-700 px-1 rounded">slide1.png ~ slideN.png</code> 파일이 들어있는지 확인하세요.
      </p>
    </div>
  </div>
  <div class="w-full bg-gray-700 h-2">
    <div id="progress-bar" class="bg-cyan-500 h-2 transition-all duration-300" style="width:0%"></div>
  </div>
</main>

<footer class="w-full max-w-6xl mt-4 flex items-center justify-between px-2">
  <div class="flex gap-3">
    <button id="prev" class="bg-gray-700 hover:bg-cyan-600 text-white font-bold py-2 px-5 rounded-lg transition-colors duration-200">이전 (←)</button>
    <button id="next" class="bg-cyan-500 hover:bg-cyan-400 text-gray-900 font-bold py-2 px-5 rounded-lg transition-colors duration-200">다음 (→)</button>
  </div>
  <div id="counter" class="text-lg font-semibold text-gray-300">Slide 1 / ?</div>
</footer>

<script>
const IMAGE_FOLDER = 'Slides%20';
const IMAGE_PREFIX = 'slide';
const IMAGE_EXTENSION = 'png';
const MAX_SLIDES = 50; // 최대 감지 장 수

let slides = [];
let currentSlideIndex = 0;

const slideImage = document.getElementById('slide-image');
const counter = document.getElementById('counter');
const progressBar = document.getElementById('progress-bar');
const prevButton = document.getElementById('prev');
const nextButton = document.getElementById('next');
const errorMessage = document.getElementById('error-message');
const errorPath = document.getElementById('error-path');

// --- 존재하는 파일만 slides 배열에 추가 ---
let tempSlides = [];
let loadedCount = 0;

for (let i = 1; i <= MAX_SLIDES; i++) {
  const path = `${IMAGE_FOLDER}${IMAGE_PREFIX}${i}.${IMAGE_EXTENSION}`;
  const img = new Image();
  
  img.onload = () => {
    tempSlides.push({ index: i, path: path });
    loadedCount++;
    checkAllLoaded();
  };
  
  img.onerror = () => {
    loadedCount++;
    // 로드 실패 파일 표시 (선택 사항)
    console.warn(`Slide not found: ${path}`);
    checkAllLoaded();
  };

  img.src = path;
}

// --- 모든 이미지 로드 후 처리 ---
function checkAllLoaded() {
  if (loadedCount === MAX_SLIDES || loadedCount === tempSlides.length + (MAX_SLIDES - tempSlides.length)) {
    // 번호 기준 오름차순 정렬
    slides = tempSlides.sort((a, b) => a.index - b.index).map(item => item.path);
    if (slides.length > 0) {
      showSlide(0);
    } else {
      errorMessage.style.display = 'block';
      errorMessage.textContent = "No slides found!";
    }
  }
}

// --- 슬라이드 표시 함수 ---
function showSlide(idx) {
  if (idx < 0 || idx >= slides.length) return;
  currentSlideIndex = idx;
  slideImage.src = slides[idx];
  counter.textContent = `${idx + 1} / ${slides.length}`;
  progressBar.value = ((idx + 1) / slides.length) * 100;
}

function nextSlide(){ showSlide(currentSlideIndex+1); }
function prevSlide(){ showSlide(currentSlideIndex-1); }

nextButton.addEventListener('click', nextSlide);
prevButton.addEventListener('click', prevSlide);
document.addEventListener('keydown', e => {
  if(e.key==='ArrowRight'||e.key===' ') { e.preventDefault(); nextSlide(); }
  if(e.key==='ArrowLeft') { e.preventDefault(); prevSlide(); }
});
</script>

</body>
</html>
